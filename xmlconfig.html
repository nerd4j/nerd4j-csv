
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at Sep 15, 2015
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>XML Configuration | NERD4J-CSV</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/spacelab/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/bootswatch.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/default.min.css" rel="stylesheet" />

		<link href="./css/lightbox.css" rel="stylesheet" />

		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->



	</head>

	<body class="page-xmlconfig project-nerd4j-csv" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="https://github.com/nerd4j/nerd4j-csv">NERD4J-CSV</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="index.html" title="Overview">Overview</a></li>
							<li ><a href="project-info.html" title="Project Info">Project Info</a></li>
							<li ><a href="download.html" title="Download">Download</a></li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="quickstart.html" title="Quick Start">Quick Start</a></li>
									<li ><a href="annotations.html" title="Annotations">Annotations</a></li>
									<li class="active"><a href="" title="XML Configuration">XML Configuration</a></li>
									<li ><a href="databinding.html" title="Other data models">Other data models</a></li>
									<li ><a href="spring.html" title="Spring integration">Spring integration</a></li>
									<li ><a href="apidocs/index.html" title="See JavaDocs">See JavaDocs</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<div id="bannerLeft"><h1>NERD4J-CSV</h1></div>
					<p class="lead">So far this is the quickest, easiest and most configurable open source Java framework for CSV manipulation.</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
	</div>
		<hr class="toc-separator" />
		<div id="toc-bar" class="navbar" data-spy="affix" data-offset-top="250">
			<div class="navbar-inner">
				<div id="toc-scroll-target" class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#toc-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<div class="nav-collapse collapse" id="toc-nav-collapse">
						<ul id="toc" class="nav">
						<li class="toplevel"><a href="#The_configuration_XML" title="The configuration XML">The configuration XML</a></li>
						<li class="divider-vertical"></li>
						<li class="toplevel"><a href="#The_configuration_registry" title="The configuration registry">The configuration registry</a></li>
						<li class="divider-vertical"></li>
						<li class="toplevel"><a href="#Configuring_custom_processors" title="Configuring custom processors">Configuring custom processors</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<div class="section"> 
 <div class="page-header">
  <h2 id="The_configuration_XML">The configuration XML</h2>
 </div> 
 <p>Annotations provide fast and easy configuration, but to use all the functionalities of the nerd4j-csv framework we suggest to use the xml version. All the available XML elements and attributes can be found in the related <a class="externalLink" href="https://github.com/nerd4j/nerd4j-csv/blob/master/src/main/resources/META-INF/csv-configuration.xsd">XSD file</a>.</p> 
 <p>As example we will convert the annotation configuration used in the previous chapters into an equivalent XML. To do so we will write the following <tt>csv-conf.xml</tt> file:</p> 
 <div class="source"> 
  <pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;csv:configuration xmlns:csv=&quot;http://www.nerd4j.org/csv&quot;  
                   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
                   xsi:schemaLocation=&quot;http://www.nerd4j.org/csv http://www.nerd4j.org/csv &quot;&gt;
    
  &lt;!-- CSV-READER CONFIGURATION --&gt;
  &lt;csv:reader name=&quot;modelReader&quot;&gt;

    &lt;csv:model-binder type=&quot;bean&quot; bean-class=&quot;full.path.to.Model&quot; /&gt;

    &lt;csv:columns&gt;

      &lt;csv:column name=&quot;user_name&quot; mapping=&quot;name&quot; /&gt;
      &lt;csv:column name=&quot;password&quot;  mapping=&quot;password&quot; optional=&quot;true&quot; /&gt;
      &lt;csv:column name=&quot;user_age&quot;  mapping=&quot;age&quot; processor-ref=&quot;parseInteger&quot; /&gt;
    
      &lt;csv:column name=&quot;user_type&quot; mapping=&quot;type&quot;&gt;
        &lt;csv:processor&gt;
          &lt;csv:converter type=&quot;parseEnum&quot; enum-type=&quot;full.path.to.UserType&quot; /&gt;
        &lt;/csv:processor&gt;
      &lt;/csv:column&gt;

      &lt;csv:column name=&quot;registration&quot; mapping=&quot;registration&quot;&gt;
        &lt;csv:processor&gt;
          &lt;csv:converter type=&quot;parseDate&quot; pattern=&quot;dd-MM-yyyy&quot; /&gt;
        &lt;/csv:processor&gt;
      &lt;/csv:column&gt;

    &lt;/csv:columns&gt;
  &lt;/csv:reader&gt;  

&lt;/csv:configuration&gt;
</pre> 
 </div> 
 <p>As usual the XML configuration is much more verbose than the annotation but is also more powerful. Fortunately we can take advantage from both the immediacy of annotations and the expressivity of XML. The nerd4j-csv framework provides an inheritance system that allows to inherit and override existing configurations. In particular we can annotate the model class with a basic configuration and extend it in the XML file using inheritance. In this way the same class can be configured in different ways depending on the actual purpose.</p> 
 <p>So, following the example, we can inherit from the annotated bean and change the way dates are parsed:</p> 
 <div class="source"> 
  <pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;csv:configuration xmlns:csv=&quot;http://www.nerd4j.org/csv&quot;  
                   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
                   xsi:schemaLocation=&quot;http://www.nerd4j.org/csv http://www.nerd4j.org/csv &quot;&gt;
    
  &lt;!-- CSV-READER CONFIGURATION --&gt;
  &lt;csv:reader name=&quot;modelReader&quot; inherit=&quot;full.path.to.Model&quot;&gt;

    &lt;csv:columns&gt;

      &lt;csv:column name=&quot;registration&quot; mapping=&quot;registration&quot;&gt;
        &lt;csv:processor&gt;
          &lt;csv:converter type=&quot;parseDate&quot; pattern=&quot;dd/MM/yyyy&quot; /&gt;
        &lt;/csv:processor&gt;
      &lt;/csv:column&gt;

    &lt;/csv:columns&gt;
  &lt;/csv:reader&gt;  

&lt;/csv:configuration&gt;
</pre> 
 </div> 
 <p>Each configuration needs to have a name, the tag <tt>inherit</tt> requires the name of the configuration to inherit from. By default the configurations made using annotations are named using the full class name of the annotated bean. If we want to take advantage from both annotations and XML we need to tell the <tt>CSVConfigurationFactory</tt> from where to read configurations. In this case we should write:</p> 
 <div class="source"> 
  <pre>  // This factory is able to pase annotations and XML files and produce a CSVConfiguration.
  final CSVConfigurationFactory configurationFactory = new CSVConfigurationFactory();

  // The factory reads the annotations in the given class and creates the related CSVConfiguration.
  final CSVConfiguration configuration = configurationFactory.getCSVConfiguration( &quot;path/to/csv-conf.xml&quot;, Model.class );
...
</pre> 
 </div> 
 <hr /> 
</div> 
<div class="section"> 
 <h2 id="The_configuration_registry">The configuration registry</h2> 
 <p>Suppose to have to parse a CSV file with 60 fields: 20 numerics, 20 enumerations and 20 dates. Writing 20 times the same configuration for each type of field can be very annoying. Therefore the nerd4j-csv framework provides a registry where you can store configurations that can be referenced from both XML and annotations. The registry can be configured only in the XML file. For example we want to register the date processor so that we can reference it from the annotated bean:</p> 
 <div class="source"> 
  <pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;csv:configuration xmlns:csv=&quot;http://www.nerd4j.org/csv&quot;  
                   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
                   xsi:schemaLocation=&quot;http://www.nerd4j.org/csv http://www.nerd4j.org/csv &quot;&gt;
  
  &lt;!-- CSV CONFIGURATION REGISTRY --&gt;
  &lt;csv:register&gt;
    
    &lt;csv:processors&gt;
      &lt;csv:processor name=&quot;parseMyDate&quot;&gt;
        &lt;csv:converter type=&quot;parseDate&quot; pattern=&quot;dd/MM/yyyy&quot; /&gt;
      &lt;/csv:processor&gt;
    &lt;/csv:processors&gt;
  
  &lt;/csv:register&gt;

  &lt;!-- CSV-READER CONFIGURATION --&gt;
  ...
  &lt;csv:column name=&quot;registration&quot; mapping=&quot;registration&quot; processor-ref=&quot;parseMyDate&quot; /&gt;
  ...
&lt;/csv:configuration&gt;
</pre> 
 </div> 
 <p>The same way we can change the annotation on the <tt>Model</tt> property as follows:</p> 
 <div class="source"> 
  <pre>  @CSVReader
  @CSVWriter
  public class Model
  {
    ...
    @CSVColumn(readProcessorRef=&quot;parseMyDate&quot;)
    public Date getRegistration()
    {
      return registration;
    }
    public void setRegistration( Date registration )
    {
      this.registration = registration;
    }
    ...
  }
</pre> 
 </div> 
 <hr /> 
</div> 
<div class="section"> 
 <h2 id="Configuring_custom_processors">Configuring custom processors</h2> 
 <p>It is also possible to register custom processor types. Lets say our CSV file contains 3 columns: <i>name</i> of type String, <i>price</i> of type Float and <i>currency</i> containing the symbol of the currency related to the price. We want to map the CSV records in the following model:</p> 
 <div class="source"> 
  <pre>  @CSVReader
  @CSVWriter
  public class Product
  {
    private String name;
    private Float  price;
    private Currency currency;

    public Product()
    {
      super();

      this.name = null;
      this.price  = null;
      this.currency  = null;
    }

    @CSVColumn
    public String getName()
    {
      return this.name;
    }
    public void setName( String name )
    {
      this.name = name;
    }

    @CSVColumn
    public Float getPrice()
    {
      return this.price;
    }
    public void setPrice( Float price )
    {
      this.price = price;
    }

    ???
    public Currency getCurrency()
    {
      return this.currency;
    }
    public void setCurrency( Currency currency )
    {
      this.currency = currency;
    }
}
</pre> 
 </div> 
 <p>What do we need to do to map the symbol $ into the related <tt>java.util.Currency</tt> instance? First of all we need to write an implementation of the <tt>org.nerd4j.csv.field.converter.CSVFieldConverter</tt> interface able to convert a <tt>String</tt> containing a currency symbol into <tt>Currency</tt> instance.</p> 
 <div class="source"> 
  <pre>public class SymbolToCurrencyConverter extends AbstractCSVFieldConverter&lt;String, Currency&gt;
{

  public CurrencyConverter()
  {
    super( &quot;Unable to convert {1} into Currency&quot;);
  }

  @Override
  protected Currency performConversion( String source ) throws Exception
  {
    if( source == null || source.length() != 1 )
      throw new IllegalArgumentException( source + &quot; is not a valid currency symbol.&quot;);
	
    final char symbol = source.charAt( 0 );
    switch( symbol )
    {
      case '$': return Currency.getInstance( &quot;USD&quot; );
      case '€': return Currency.getInstance( &quot;EUR&quot; );
      case '&pound;': return Currency.getInstance( &quot;GBP&quot; );
      ...	
      default: throw new IllegalArgumentException( &quot;Unable to recognize symbol &quot; + source );
    }
  }
}
</pre> 
 </div> 
 <p>In this case we extended the <tt>AbstractCSVFieldConverter</tt> class that performs some work for us. Next we need to implement the <tt>CSVRegistryEntryProvider</tt> interface able to build a <tt>SymbolToCurrencyConverter</tt> according to the configurations provided from the framework.</p> 
 <div class="source"> 
  <pre>public class SymbolToCurrencyProvider implements CSVRegistryEntryProvider&lt;SymbolToCurrencyConverter&gt;
{
  public SymbolToCurrencyProvider()
  {
    super();
  }

  @Override
  public SymbolToCurrencyConverter get( Map&lt;String,String&gt; params )
  {
    // This converter does not need any parameter. 
    return new SymbolToCurrencyConverter();
  }

  @Override
  public void validate( Map&lt;String,String&gt; params ) throws CSVConfigurationException
  {
    // In this case parameters validation is not needed.
  }
}
</pre> 
 </div> 
 <p>As last step we register our <tt>SymbolToCurrencyProvider</tt> and for convenience also the related <tt>SymbolToCurrencyConverter</tt> in the framework using the XML configuration:</p> 
 <div class="source"> 
  <pre>&lt;csv:register&gt;

  &lt;csv:types&gt;
    &lt;!-- Here we define the converter provider (or type provider) --&gt;
    &lt;csv:converter type-name=&quot;parseCurrencySymbol&quot; provider-class=&quot;full.path.to.SymbolToCurrencyProvider&quot;/&gt;
  &lt;/csv:types&gt;

  &lt;csv:processors&gt;
    &lt;!-- 
      And here we register the preconfigured instance of the SymbolToCurrencyConverter class
      to call by reference in the related field annotation. Actually we register a CSVProcessor
      that contains a CSVConverter of type &quot;parseCurrencySymbol&quot;.
    --&gt;
    &lt;csv:processor name=&quot;parseCurrencySymbol&quot;&gt;
      &lt;csv:converter type=&quot;parseCurrencySymbol&quot; /&gt;
    &lt;/csv:processor&gt;
  &lt;/csv:processors&gt;
&lt;/csv:register&gt;
</pre> 
 </div> 
 <p>Now we can complete our <tt>Product</tt> class by annotating the currency field in order to use the new created converter:</p> 
 <div class="source"> 
  <pre>...
@CSVColumn(processorRef=&quot;parseCurrencySymbol&quot;)
public Currency getCurrency()
{
  return this.currency;
}
public void setCurrency( Currency currency )
{
  this.currency = currency;
}
...
</pre> 
 </div> 
 <p>Thats it! The built in processors cover all the most common use cases, but if needed the implementation of a custom <tt>CSVFieldProcessor</tt> is a quite easy job.</p> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span9 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li >
							<a href="quickstart.html" title="Quick Start">Quick Start</a>
						</li>
						<li >
							<a href="annotations.html" title="Annotations">Annotations</a>
						</li>
						<li class="active">
							<a href="#" title="XML Configuration">XML Configuration</a>
						</li>
						<li >
							<a href="databinding.html" title="Other data models">Other data models</a>
						</li>
						<li >
							<a href="spring.html" title="Spring integration">Spring integration</a>
						</li>
						<li >
							<a href="apidocs/index.html" title="See JavaDocs">See JavaDocs</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote><a href="http://www.java.net"><img src="http://www.java.net/sites/default/files/51226_thumb_Java.net_Member_clr.gif.jpg" alt="Java.net Member"></a></blockquote>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2013-2015 <a href="http://nerd4j.org">Nerd4j</a>. All Rights Reserved.</p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.min.js"></script>
	<script src="./js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="./js/reflow-skin.js"></script>

	</body>
</html>
